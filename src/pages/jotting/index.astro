---
import { getCollection } from "astro:content";
import Base from "$layouts/Base.astro";
import Jotting from "$components/Jotting.svelte";
import Icon from "$components/Icon.astro";
import { getListSEO } from "$utils/seo";

// 生成列表页 SEO 配置
const seoConfig = getListSEO(Astro.site!, Astro.url.pathname, "随笔");

const jottings = await getCollection("jotting", jotting => {
	// Filter by publication status and locale
	let published = !jotting.data.draft;
	let localed = jotting.id.split("/")[0] === "zh-cn";

	return published && localed;
});

// Standardize note structure
let list = jottings.map(jotting => ({
	id: jotting.id,
	data: {
		title: jotting.data.title,
		timestamp: jotting.data.timestamp,
		tags: jotting.data.tags,
		sensitive: jotting.data.sensitive,
		top: jotting.data.top
	}
}));

// Extract all unique tags from the filtered notes
const tags = Array.from(new Set(jottings.flatMap(jotting => jotting.data.tags).filter(Boolean))).sort();
---

<Base title="随笔" seoConfig={seoConfig}>
	<main class="flex flex-col grow">
		<Jotting client:load jottings={list} {tags}>
			<Icon name="lucide:flag-triangle-right" slot="top" />
			<Icon name="lucide:siren" title="敏感内容" slot="sensitive" />
			<Icon name="lucide:arrow-left" slot="left" />
			<Icon name="lucide:arrow-right" slot="right" />
			<Icon name="lucide:ellipsis" slot="dots" />
		</Jotting>
	</main>
</Base>