---
// src/components/TOC.astro
import '../styles/toc.css';
---

<aside id="toc-container" client:load>
  <nav id="toc-nav">
    <ul class="toc-tree"></ul>
  </nav>
</aside>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // 生成目录树
    const headings = document.querySelectorAll('article h2, article h3');
    const tocList = document.querySelector('.toc-tree');
    
    // 动态锚点注入
    headings.forEach((h, index) => {
      h.id = `heading-${index}`;
      const listItem = document.createElement('li');
      listItem.className = `toc-level-${h.tagName.toLowerCase()}`;
      
      // 创建链接元素
      const anchor = document.createElement('a');
      anchor.href = `#heading-${index}`;
      anchor.textContent = h.textContent;
      anchor.onclick = (e) => {
        e.preventDefault();
        h.scrollIntoView({ behavior: 'smooth' });
      };
      
      // 交互状态跟踪
      const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
          anchor.classList.toggle('active', entry.isIntersecting);
        });
      }, { threshold: 0.5 });
      observer.observe(h);

      listItem.appendChild(anchor);
      tocList.appendChild(listItem);
    });
  });
</script>
