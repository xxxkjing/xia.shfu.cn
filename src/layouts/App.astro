---
import { SEO } from "astro-seo";
import type { SEOConfig } from "$utils/seo";

const { title, subtitle, description, author, article, seoConfig } = Astro.props;

// Locale-specific Noto Serif font mappings for Google Fonts
const notoFonts: Record<string, string> = {
	"zh-cn": "Noto+Serif+SC",
	ja: "Noto+Serif+JP"
};

// 构建完整标题
const fullTitle = subtitle ? `${subtitle} | ${title}` : title;

// 使用传入的 seoConfig 或构建默认配置
const seo: SEOConfig = seoConfig || {
	title: fullTitle,
	description: description,
	canonical: new URL(Astro.url.pathname, Astro.site).toString(),
	openGraph: {
		basic: {
			title: fullTitle,
			type: (article && "article") || "website",
			image: new URL("/favicon-96x96.png", Astro.site).toString(),
			url: new URL(Astro.url.pathname, Astro.site).toString()
		},
		optional: {
			description: description,
			locale: "zh_CN",
			siteName: title
		},
		...(article && {
			article: {
				publishedTime: article.timestamp.toISOString(),
				section: article.section,
				tags: article.tags,
				authors: [author]
			}
		})
	}
};
---

<html lang="zh-cn">
	<head>
		<SEO
			title={seo.title}
			description={seo.description}
			canonical={seo.canonical}
			noindex={seo.noindex}
			nofollow={seo.nofollow}
			openGraph={seo.openGraph}
		/>

		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />

		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/favicon-96x96.png">
		<link rel="sitemap" href="/sitemap-index.xml" />

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif:ital,wght@0,100..900;1,100..900&display=swap" />
		<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playwrite+MX:wght@100..400&display=block" />
		<link rel="stylesheet" href="https://fontsapi.zeoseven.com/442/main/result.css" />
		<link rel="stylesheet" href="https://fontsapi.zeoseven.com/556/main/result.css" />
		<link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.4/katex.min.css" onload="this.onload=null;this.rel='stylesheet'" />

		<link rel="stylesheet" href={`https://fonts.googleapis.com/css2?family=${notoFonts["zh-cn"]}:wght@200..900&display=swap`} />

		<script is:inline>
			var theme = localStorage.getItem("theme");
			if (theme) document.documentElement.dataset.theme = theme;
		</script>
	</head>
	<body>
		<slot />
	</body>
</html>
